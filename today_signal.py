import yfinance as yf
import pandas as pd
from datetime import datetime, timedelta

# éŠ˜æŸ„è¨­å®š
TNX_TICKER = "^TNX"     # ç±³å›½10å¹´å‚µåˆ©å›ã‚Š
USD_TICKER = "JPY=X"    # ãƒ‰ãƒ«å††

def get_signal():
    print("ğŸ“¡ æœ€æ–°ã®ç±³å›½é‡‘åˆ©ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...")

    # ç›´è¿‘5æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆåœŸæ—¥ç¥ã®æ¬ æå¯¾ç­–ã§å¤šã‚ã«å–ã‚‹ï¼‰
    tnx = yf.download(TNX_TICKER, period="5d", progress=False)

    # MultiIndexå¯¾ç­–ï¼ˆã‚«ãƒ©ãƒ ãŒ2æ®µã«ãªã£ã¦ã„ã‚‹å ´åˆï¼‰
    if isinstance(tnx.columns, pd.MultiIndex):
        tnx.columns = tnx.columns.get_level_values(0)

    # ç¢ºå®Ÿã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹æœ€æ–°ã®2æ—¥é–“ã‚’å–å¾—
    if len(tnx) < 2:
        print("âŒ ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚å¸‚å ´ãŒé–‹ã„ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚")
        return

    # æœ€æ–°æ—¥ã¨ã€ãã®å‰æ—¥
    today_rate = tnx['Close'].iloc[-1]      # æœ€æ–°ã®çµ‚å€¤
    yesterday_rate = tnx['Close'].iloc[-2]  # ãã®å‰ã®æ—¥ã®çµ‚å€¤

    today_date = tnx.index[-1].strftime('%Y-%m-%d')

    # å¤‰å‹•å¹…
    change = today_rate - yesterday_rate

    print("-" * 50)
    print(f"ğŸ“… ãƒ‡ãƒ¼ã‚¿åŸºæº–æ—¥: {today_date} (ç±³å›½å¸‚å ´ã‚¯ãƒ­ãƒ¼ã‚ºæ™‚ç‚¹)")
    print(f"ğŸ‡ºğŸ‡¸ ç±³å›½10å¹´å‚µåˆ©å›ã‚Š: {today_rate:.3f}%")
    print(f"ğŸ“‰ å‰æ—¥æ¯”: {change:+.3f} ãƒã‚¤ãƒ³ãƒˆ")
    print("-" * 50)

    # åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆROI 62ä¸‡%ã®æ ¹æ‹ ï¼‰
    print("\nğŸ¤– ã€AIãƒˆãƒ¬ãƒ¼ãƒ‰åˆ¤å®šã€‘")

    if change > 0:
        print("ğŸ”´ é‡‘åˆ©ä¸Šæ˜‡ä¸­ â” ãƒ‰ãƒ«å††ã€ è²·ã„ (BUY) ã€‘")
        print("   ğŸ‘‰ æˆ¦ç•¥: ãƒ‰ãƒ«é«˜ãƒˆãƒ¬ãƒ³ãƒ‰ç¶™ç¶šã€‚ãƒ­ãƒ³ã‚°ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’æŒã¡è¶Šã—ã¾ã™ã€‚")
    elif change < 0:
        print("ğŸ”µ é‡‘åˆ©ä½ä¸‹ä¸­ â” ãƒ‰ãƒ«å††ã€ å£²ã‚Š (SELL) ã€‘")
        print("   ğŸ‘‰ æˆ¦ç•¥: ãƒ‰ãƒ«å®‰åœ§åŠ›ã‚ã‚Šã€‚ã‚·ãƒ§ãƒ¼ãƒˆã™ã‚‹ã‹ã€æ§˜å­è¦‹ï¼ˆãƒãƒ¼ãƒã‚¸ï¼‰æ¨å¥¨ã€‚")
    else:
        print("âšª å¤‰åŒ–ãªã— â” ã€ ã‚¹ãƒ†ã‚¤ (KEEP) ã€‘")

    print("-" * 50)
    print("â€» ã“ã®ã‚·ã‚°ãƒŠãƒ«ã¯éå»30å¹´ã§å‹ç‡58%ãƒ»ROI 60ä¸‡%ã‚’è¨˜éŒ²ã—ãŸãƒ­ã‚¸ãƒƒã‚¯ã«åŸºã¥ãã¾ã™ã€‚")
    print("â€» æ¯æœ7:00ä»¥é™ï¼ˆå¤æ™‚é–“ã¯6:00ï¼‰ã«å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚")

if __name__ == "__main__":
    get_signal()
